Практически каждому пользователю компьютера рано или поздно приходится сталкиваться с проблемой переименования сразу нескольких файлов. Например, сменить расширение файла, поменять имя, вставить порядковый номер и так далее. Кто-то пишет shell скрипты, кто-то использует специально созданные для этой цели программы, но настоящие индейцы используют Emacs.  
  
В Emacs существует такой режим как **dired**. Это режим просмотра директории. Чтобы включить его достаточно набрать  
  
`Alt-x dired`  
  
после этого достаточно выбрать путь к директории  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/c68/a9f/4d6/c68a9f4d63ef7872f76890ad089c4806.png)  
  
Допустим, нам нужно переименовать файлы в этой директории, превратив имя **yuka** в имя и фамилию **yuka.kemmochi**. Будем использовать для этого регулярные выражения[[1](https://habr.com/ru/post/99762/#wdired-change-to-wdired-mode)]. Почему регулярные выражения? Потому что это пожалуй самый гибкий способ. И хотя в данном случае мы стреляем из лазерной пушки с автоматической наводкой по воробьям, техника опробованная здесь пригодится в более сложных случаях.  
  

##### Регулярные Выражения в Emacs

  
Регулярные выражения не так уж просты сами по себе. В Emacs дело осложняется тем, что он использует POSIX регулярные выражения, и спецсимволы необходимо экранировать слэшем. Так как слэш сам по себе спецсимвол, то его также необходимо экранировать. Плюс ко всему в строках каждый слэш необходимо удваивать. Все это приводит к тому, что регулярное выражение в Emacs может выглядеть, например, вот так  
`\\<\\(HKCU\\|HKLM\\|dirifempty\\|files\\|filesandordirs\\)\\>   `  
Что соответствует обычному  
`^(HKCU|HKLM|dirifempty|files|filesandordirs)$   `  
С другой стороны регулярные выражения в Emacs очень легко составлять и тестировать. Для этого мы задействуем пожалуй один из самых мощных инструментов Emacs RE-builder:  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/9a0/ab4/7a2/9a0ab47a2f8ca5b456af0da563acd91f.png)  
  
В открывшемся поле можно вводить выражение, помня о том, что вводится оно как строка, поэтому все слэши необходимо удваивать.  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/678/4af/180/6784af18048d597fd03e3605db6c6a00.png)  
  
Ввод этот интерактивен, то есть Emacs подкрасит то, что соответствует введенному выражению. Более того, отдельные группы выделяются отдельным цветом.  
  
Составив выражение мы готовы переименовывать файлы.  
  

##### Операции с файлами

  
  
Перед тем как оперировать с файлами, нам необходимо их выделить. Можно просто перемещаясь по буферу и вставая на имя файла нажимать **m**, можно ввести **% g** и затем в приглашении ввести часть имени файлов, можно использовать опять же регулярные выражения ввеля **% m**  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/c06/42b/173/c0642b1738d44fa4a91a5160f0b43cc3.png)  
  
Выделить все файлы достаточно просто  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/a10/70d/86d/a1070d86d3d69b0ed1ce7e0e6323d014.png)  
  
Вуаля  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/86d/ed8/a23/86ded8a237e76fc05e91c9a4fe90c9d0.png)  
  
Дальнейшие операции проходят над выделенными файлами.  
  
Чтобы переименовать файлы используя регулярные выражения нажмем **% R**.  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/f27/e8c/c92/f27e8cc92eed000faadd528fbf1ec319.png)  
  
Регистр буквы важен, то есть нажимается **Shift** и **5** и затем не отпуская **Shift** нажимаем **r**. Как правило, **5** и **r** находятся рядом на клавиатуре поэтому переименование файлов используя регулярные выражения можно запустить довольно быстро и просто.  
  
Вводим наше регулярное выражение, помня о том, что количество слешей должно «уполовинится» по сравнению с тем что мы пробовали в RE-builder.  
  
  
_Дополнительная фишка заключается в том, что Emacs запоминает то, что вы вводили в приглашения до этого и достаточно просто перемещаться по истории ввода используя **Alt-p** — назад и **Alt-n** — вперед. Выбрав нужную строку из истории можно ее отредактировать и использовать вновь.  
_  
  
После этого предлагается ввести выражения для нового имени файла  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/26b/400/8f4/26b4008f4f8dfedd50d56a08a153067e.png)  
  
**Alt-p/Alt-n** работают и здесь.  
  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/225/8ea/c9c/2258eac9c20d4881a7cb9a6bacbacc1b.png)  
  
Мы используем, так называемые, замены (Regular Expression Replacements). Наиболее интересны следующие:  

-   **\1...\9** — группы, то есть то что в исходном выражении ограничено скобками \( и \) в порядке следования слева — внутрь — направо
-   **\&** — то что пришлось на все регулярное выражение (то есть группа 0)
-   **\?** — приглашение пользователя к вводу. При каждом переименовании Emacs будет спрашивать, что ему вставить вместо **\?**

  
При первом переименовании Emacs спросит  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/88e/ae6/86a/88eae686a51b3480542aa3fd16578fc7.png)  
  
Стоит отметить, что переименовываться будут только те файлы из выделенных чье имя соответствует регулярному выражению введенному сразу после **% R**  
  
Можно нажимать **y/n**, соглашаясь или отказываясь переименовывать файл. Emacs перейдет к следующему. Можно нажать **!** (то есть **Shift 1  
**), заставив Emacs пробежаться по всем отмеченным файлам, либо можно закончить всю операцию по переименованию нажав **q**.  
![image](https://habrastorage.org/r/w1560/getpro/habr/post_images/2da/226/387/2da22638731a9c101270cb9d9a2e4d2a.png)  
  
Легко и просто файлы переименованы.